{"status":{},"spec":{"name":"Jboss-Existing","description":"","resources":{"service_definition_list":[{"name":"Service1","description":"","variable_list":[],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"26f68591_runbook","description":"","task_definition_list":[{"type":"DAG","name":"c77cab56_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"c77cab56_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"e1f9d375_runbook","description":"","task_definition_list":[{"type":"DAG","name":"4551534c_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"4551534c_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"c044134b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"0acb291a_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"0acb291a_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"c750d583_runbook","description":"","task_definition_list":[{"type":"DAG","name":"c0a6f253_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"c0a6f253_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"019f0cc4_runbook","description":"","task_definition_list":[{"type":"DAG","name":"5005541e_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"5005541e_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"EXISTING_VM","name":"VM1","description":"","variable_list":[],"action_list":[],"create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"10.38.176.42"},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"Login","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"60","retries":"5","address":"@@{ip_address}@@","disable_readiness_probe":false,"connection_protocol":""}}],"package_definition_list":[{"type":"DEB","name":"Package1","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"Service1","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"59d386be_runbook","description":"","task_definition_list":[{"type":"DAG","name":"8309e720_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"remount_tmp","kind":"app_task"},"to_task_reference":{"name":"install_jboss_prerequisites","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"install_jboss_prerequisites","kind":"app_task"},"to_task_reference":{"name":"create_jboss_user","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"create_jboss_user","kind":"app_task"},"to_task_reference":{"name":"setup_storage_lvm","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"setup_storage_lvm","kind":"app_task"},"to_task_reference":{"name":"set_mount_permissions","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"set_mount_permissions","kind":"app_task"},"to_task_reference":{"name":"configure_sysctl","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"configure_sysctl","kind":"app_task"},"to_task_reference":{"name":"configure_ulimit","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"configure_ulimit","kind":"app_task"},"to_task_reference":{"name":"configure_jboss_umask","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"configure_jboss_umask","kind":"app_task"},"to_task_reference":{"name":"configure_jboss_sudoers","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"configure_jboss_sudoers","kind":"app_task"},"to_task_reference":{"name":"configure_systemd","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"configure_systemd","kind":"app_task"},"to_task_reference":{"name":"start_service","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"remount_tmp","kind":"app_task"},{"name":"install_jboss_prerequisites","kind":"app_task"},{"name":"create_jboss_user","kind":"app_task"},{"name":"setup_storage_lvm","kind":"app_task"},{"name":"set_mount_permissions","kind":"app_task"},{"name":"configure_sysctl","kind":"app_task"},{"name":"configure_ulimit","kind":"app_task"},{"name":"configure_jboss_umask","kind":"app_task"},{"name":"configure_jboss_sudoers","kind":"app_task"},{"name":"start_service","kind":"app_task"},{"name":"configure_systemd","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"Package1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"remount_tmp","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Remounting \/tmp Filesystem ===\"\n\n# Find \/tmp mount point\nTMP_MOUNT=$(mount | grep \" \/tmp \" | awk '{print $1}' || echo \"\")\n\nif [ -z \"$TMP_MOUNT\" ]; then\n    echo \"WARNING: \/tmp mount point not found, skipping remount\"\n    exit 0\nfi\n\n# Get filesystem type\nTMP_FSTYPE=$(mount | grep \" \/tmp \" | awk '{print $5}' || echo \"xfs\")\n\necho \"Current \/tmp mount: $TMP_MOUNT (type: $TMP_FSTYPE)\"\n\n# Remount \/tmp with defaults (Ansible pattern)\nif mountpoint -q \/tmp; then\n    echo \"Remounting \/tmp filesystem\"\n    sudo mount -o remount,defaults \/tmp || {\n        echo \"WARNING: Failed to remount \/tmp\"\n    }\n    echo \"\u2713 \/tmp remounted successfully\"\nelse\n    echo \"WARNING: \/tmp is not mounted\"\nfi\n\n# Verify mount\necho \"Current \/tmp mount status:\"\nmount | grep \" \/tmp \" || df -h \/tmp\n\necho \"=== \/tmp Remount Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"install_jboss_prerequisites","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Installing JBoss Prerequisites ===\"\n\n# JBoss prerequisite packages (from defaults_main.yml)\nJBOSS_PACKAGES=(\n    \"telnet\"\n    \"iotop\"\n    \"dos2unix\"\n    \"sysstat\"\n    \"apr\"\n    \"apr-devel\"\n    \"apr-util\"\n    \"apr-util-devel\"\n    \"apr-util-ldap\"\n    \"krb5-workstation\"\n    \"openssl\"\n    \"rsync\"\n    \"procps-ng\"\n    \"gdb\"\n    \"tree\"\n    \"lsof\"\n    \"tcpdump\"\n    \"net-tools\"\n    \"systemtap\"\n    \"systemtap-runtime\"\n)\n\n# Install packages\necho \"Installing JBoss prerequisite packages...\"\nfor package in \"${JBOSS_PACKAGES[@]}\"; do\n    if ! rpm -q \"$package\" &>\/dev\/null; then\n        echo \"Installing $package...\"\n        sudo dnf install -y -q \"$package\" || sudo yum install -y -q \"$package\" || {\n            echo \"Warning: Failed to install $package\"\n        }\n    else\n        echo \"$package is already installed\"\n    fi\ndone\n\necho \"=== JBoss Prerequisites Installation Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"create_jboss_user","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Creating JBoss User and Group ===\"\n\n# Create jbadmin group (GID 1101)\nJBADMIN_GROUP=\"jbadmin\"\nJBADMIN_GID=\"1101\"\n\nif ! getent group \"$JBADMIN_GROUP\" &>\/dev\/null; then\n    echo \"Creating group $JBADMIN_GROUP with GID $JBADMIN_GID\"\n    sudo groupadd -g \"$JBADMIN_GID\" \"$JBADMIN_GROUP\"\nelse\n    echo \"Group $JBADMIN_GROUP already exists\"\nfi\n\n# Create jboss user (UID 1100)\nJBOSS_USER=\"jboss\"\nJBOSS_UID=\"1100\"\nJBOSS_COMMENT=\"Jboss Admin User\"\n# Password hash from Ansible (same as in tasks_main.yml)\nJBOSS_PASSWORD_HASH='$6$mysecretsalt$lY28kKHPxeHweW8i7GqNuYb5pZus35c4J6EXa9dd5zJwOj2w\/Xwn\/Wjl7UHk6h5ruLsb5H4ndgrfLwowLjC6L\/'\n\nif ! id \"$JBOSS_USER\" &>\/dev\/null; then\n    echo \"Creating user $JBOSS_USER with UID $JBOSS_UID\"\n    sudo useradd -u \"$JBOSS_UID\" -g \"$JBADMIN_GROUP\" -c \"$JBOSS_COMMENT\" -m \"$JBOSS_USER\"\n    # Set password\n    echo \"$JBOSS_USER:$JBOSS_PASSWORD_HASH\" | sudo chpasswd -e\n    echo \"User $JBOSS_USER created successfully\"\nelse\n    echo \"User $JBOSS_USER already exists\"\n    # Ensure user is in correct group\n    if ! groups \"$JBOSS_USER\" | grep -q \"$JBADMIN_GROUP\"; then\n        echo \"Adding $JBOSS_USER to group $JBADMIN_GROUP\"\n        sudo usermod -a -G \"$JBADMIN_GROUP\" \"$JBOSS_USER\"\n    fi\nfi\n\n# Verify user and group\necho \"User information:\"\nid \"$JBOSS_USER\" || true\necho \"Group information:\"\ngetent group \"$JBADMIN_GROUP\" || true\n\necho \"=== JBoss User and Group Creation Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"setup_storage_lvm","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Setting up JBoss Storage with LVM ===\"\n\n# Find boot disk dynamically\nbootDiskDrive=$(sudo lsblk -r | grep boot | awk '{print substr($1,1, length($1)-1)}' | sort -u | head -1)\nif [ -z \"$bootDiskDrive\" ]; then\n    bootDiskDrive=\"sda\"\nfi\n\n# Find first additional disk (should be \/dev\/sdb)\nrawDisks=($(sudo lsblk -r -p | grep disk | awk '{print $1}' | grep -v \"\/dev\/${bootDiskDrive}\"))\n\nif [ ${#rawDisks[@]} -lt 1 ]; then\n    echo \"ERROR: No additional disk found for JBoss mount points\"\n    echo \"Available disks:\"\n    lsblk\n    exit 1\nfi\n\n# Use first additional disk\nJBOSS_DISK=\"${rawDisks[0]}\"\n\n# Get disk size to calculate LV sizes dynamically\nDISK_SIZE_BYTES=$(lsblk -b -d -o SIZE -n \"$JBOSS_DISK\" 2>\/dev\/null || echo \"0\")\nDISK_SIZE_GB=$((DISK_SIZE_BYTES \/ 1024 \/ 1024 \/ 1024))\n\necho \"JBoss disk configuration (matches Ansible tasks_main.yml):\"\necho \"  Disk: $JBOSS_DISK (${DISK_SIZE_GB} GB)\"\necho \"  Mount points:\"\necho \"    \/softwares -> lvol0 (10 GB \/ 10240 MB)\"\necho \"    \/jboss -> lvol1 (10 GB \/ 10240 MB)\"\necho \"    \/app\/logs -> lvol2 (79 GB \/ 81000 MB)\"\n\n# Install required packages\nif ! command -v pvcreate &>\/dev\/null; then\n    echo \"Installing LVM2 package...\"\n    sudo dnf install -y -q lvm2 || sudo yum install -y -q lvm2\nfi\n\nif ! command -v parted &>\/dev\/null; then\n    echo \"Installing parted package...\"\n    sudo dnf install -y -q parted || sudo yum install -y -q parted\nfi\n\n# Check if partition device exists\nJBOSS_PARTITION=\"${JBOSS_DISK}1\"\n\nif [ -b \"$JBOSS_PARTITION\" ]; then\n    echo \"Partition $JBOSS_PARTITION already exists\"\n    echo \"Using existing partition $JBOSS_PARTITION\"\nelse\n    echo \"Partition $JBOSS_PARTITION does not exist, creating it\"\n    # Create GPT partition table and partition\n    sudo parted -s \"$JBOSS_DISK\" mklabel gpt\n    sudo parted -s \"$JBOSS_DISK\" mkpart primary 0% 100%\n    sudo parted -s \"$JBOSS_DISK\" set 1 lvm on\n    \n    # Refresh partition table\n    sudo partprobe \"$JBOSS_DISK\"\n    sleep 3\n    \n    # Verify partition was created\n    if [ ! -b \"$JBOSS_PARTITION\" ]; then\n        echo \"ERROR: Partition $JBOSS_PARTITION was not created\"\n        exit 1\n    fi\n    \n    echo \"\u2713 Partition $JBOSS_PARTITION created successfully\"\nfi\n\n# Create Physical Volume\nVG_NAME=\"vg01\"\necho \"=== Creating Physical Volume ===\"\nif ! sudo pvs \"$JBOSS_PARTITION\" &>\/dev\/null; then\n    echo \"Creating physical volume on $JBOSS_PARTITION\"\n    sudo pvcreate -y \"$JBOSS_PARTITION\"\nelse\n    echo \"Physical volume already exists on $JBOSS_PARTITION\"\nfi\n\n# Create Volume Group\necho \"=== Creating Volume Group: $VG_NAME ===\"\nif ! sudo vgs \"$VG_NAME\" &>\/dev\/null; then\n    echo \"Creating volume group '$VG_NAME' from $JBOSS_PARTITION\"\n    sudo vgcreate -y \"$VG_NAME\" \"$JBOSS_PARTITION\"\nelse\n    echo \"Volume group '$VG_NAME' already exists\"\nfi\n\n# Calculate LV sizes (from Ansible: lvol0=10240MB, lvol1=10240MB, lvol2=81000MB)\nLV_SOFTWARE_SIZE_MB=\"10240\"\nLV_JBOSS_SIZE_MB=\"10240\"\nLV_LOGS_SIZE_MB=\"81000\"\n\necho \"=== Creating Logical Volumes ===\"\n\n# Create LV for \/softwares (lvol0) - matches Ansible exactly\nLV_SOFTWARE=\"${VG_NAME}\/lvol0\"\nif ! sudo lvs \"$LV_SOFTWARE\" &>\/dev\/null; then\n    echo \"Creating logical volume lvol0 for \/softwares (${LV_SOFTWARE_SIZE_MB} MB)\"\n    sudo lvcreate -y -L ${LV_SOFTWARE_SIZE_MB}M -n lvol0 \"$VG_NAME\"\nelse\n    echo \"Logical volume $LV_SOFTWARE already exists\"\nfi\n\n# Create LV for \/jboss (lvol1) - matches Ansible exactly\nLV_JBOSS=\"${VG_NAME}\/lvol1\"\nif ! sudo lvs \"$LV_JBOSS\" &>\/dev\/null; then\n    echo \"Creating logical volume lvol1 for \/jboss (${LV_JBOSS_SIZE_MB} MB)\"\n    sudo lvcreate -y -L ${LV_JBOSS_SIZE_MB}M -n lvol1 \"$VG_NAME\"\nelse\n    echo \"Logical volume $LV_JBOSS already exists\"\nfi\n\n# Create LV for \/app\/logs (lvol2) - matches Ansible exactly (81000 MB)\nLV_LOGS=\"${VG_NAME}\/lvol2\"\nif ! sudo lvs \"$LV_LOGS\" &>\/dev\/null; then\n    echo \"Creating logical volume lvol2 for \/app\/logs (${LV_LOGS_SIZE_MB} MB)\"\n    sudo lvcreate -y -L ${LV_LOGS_SIZE_MB}M -n lvol2 \"$VG_NAME\"\nelse\n    echo \"Logical volume $LV_LOGS already exists\"\nfi\n\n# Display LV information\necho \"\"\necho \"=== Logical Volumes Created ===\"\nsudo lvs \"$VG_NAME\"\n\n# Function to setup filesystem, directory, permissions, and mount (matches Ansible order)\nsetup_mount_point() {\n    local LV_PATH=$1\n    local MOUNTPOINT=$2\n    \n    echo \"=== Setting up $MOUNTPOINT ===\"\n    \n    # Step 1: Create filesystem (matches Ansible: Create FS)\n    if ! sudo blkid \"$LV_PATH\" &>\/dev\/null; then\n        echo \"Creating XFS filesystem on $LV_PATH\"\n        sudo mkfs.xfs -f \"$LV_PATH\"\n    else\n        echo \"Logical volume $LV_PATH already formatted\"\n        FSTYPE=$(sudo blkid -s TYPE -o value \"$LV_PATH\" 2>\/dev\/null || echo \"\")\n        if [ \"$FSTYPE\" != \"xfs\" ]; then\n            echo \"Warning: $LV_PATH is formatted as $FSTYPE, not xfs\"\n        fi\n    fi\n    \n    # Step 2: Create directory and set permissions BEFORE mounting (matches Ansible order)\n    echo \"Creating directory and setting permissions for $MOUNTPOINT\"\n    sudo mkdir -p \"$MOUNTPOINT\"\n    \n    # Set permissions (jboss:jbadmin, mode 0755) - matches Ansible: Directory Permission\n    if id \"jboss\" &>\/dev\/null; then\n        sudo chown jboss:jbadmin \"$MOUNTPOINT\"\n        sudo chmod 755 \"$MOUNTPOINT\"\n        echo \"  Set ownership: jboss:jbadmin, mode: 755\"\n    else\n        echo \"  Warning: jboss user not found, setting permissions as root\"\n        sudo chmod 755 \"$MOUNTPOINT\"\n    fi\n    \n    # Step 3: Mount the filesystem (matches Ansible: Create mountpoint)\n    if ! mountpoint -q \"$MOUNTPOINT\"; then\n        echo \"Mounting $LV_PATH to $MOUNTPOINT\"\n        sudo mount -o defaults \"$LV_PATH\" \"$MOUNTPOINT\"\n    else\n        echo \"$MOUNTPOINT is already mounted\"\n    fi\n    \n    # Step 4: Check directory permissions after mount (matches Ansible: Check Directory Permission)\n    echo \"Verifying directory permissions after mount\"\n    if [ -d \"$MOUNTPOINT\" ]; then\n        OWNER=$(stat -c '%U:%G' \"$MOUNTPOINT\" 2>\/dev\/null || echo \"N\/A\")\n        PERMS=$(stat -c '%a' \"$MOUNTPOINT\" 2>\/dev\/null || echo \"N\/A\")\n        echo \"  Verified: $MOUNTPOINT - $OWNER ($PERMS)\"\n        \n        # Ensure permissions are still correct (Ansible checks and sets again)\n        if id \"jboss\" &>\/dev\/null; then\n            sudo chown jboss:jbadmin \"$MOUNTPOINT\"\n            sudo chmod 755 \"$MOUNTPOINT\"\n        fi\n    fi\n    \n    # Add to \/etc\/fstab if not already present\n    if ! grep -q \"$MOUNTPOINT\" \/etc\/fstab; then\n        UUID=$(sudo blkid -s UUID -o value \"$LV_PATH\")\n        if [ -n \"$UUID\" ]; then\n            echo \"UUID=$UUID $MOUNTPOINT xfs defaults 0 0\" | sudo tee -a \/etc\/fstab\n            echo \"Added $MOUNTPOINT to \/etc\/fstab\"\n        else\n            echo \"$LV_PATH $MOUNTPOINT xfs defaults 0 0\" | sudo tee -a \/etc\/fstab\n            echo \"Added $MOUNTPOINT to \/etc\/fstab (using device path)\"\n        fi\n    fi\n}\n\n# Setup each mount point (matches Ansible order: FS \u2192 Directory Permission \u2192 Mount \u2192 Check Permission)\nsetup_mount_point \"\/dev\/${VG_NAME}\/lvol0\" \"\/softwares\"\nsetup_mount_point \"\/dev\/${VG_NAME}\/lvol1\" \"\/jboss\"\nsetup_mount_point \"\/dev\/${VG_NAME}\/lvol2\" \"\/app\/logs\"\n\necho \"\"\necho \"=== Storage Setup Complete ===\"\necho \"Mount point details:\"\ndf -h | grep -E \"(softwares|jboss|\/app\/logs)\"\necho \"\"\necho \"LVM Configuration (matches Ansible tasks_main.yml):\"\necho \"  Volume Group: $VG_NAME\"\necho \"  Physical Volume: $JBOSS_PARTITION\"\necho \"  Logical Volumes:\"\necho \"    \/softwares -> \/dev\/${VG_NAME}\/lvol0 (10 GB \/ 10240 MB)\"\necho \"    \/jboss -> \/dev\/${VG_NAME}\/lvol1 (10 GB \/ 10240 MB)\"\necho \"    \/app\/logs -> \/dev\/${VG_NAME}\/lvol2 (79 GB \/ 81000 MB)\"\necho \"\"\necho \"All mount points created with permissions (jboss:jbadmin, 755) as per Ansible\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"set_mount_permissions","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Checking Mount Point Permissions ===\"\n\n# Verify jboss user exists\nif ! id \"jboss\" &>\/dev\/null; then\n    echo \"ERROR: jboss user does not exist\"\n    exit 1\nfi\n\n# Mount points to check (matches Ansible: Check Directory Permission)\nMOUNTPOINTS=(\"\/softwares\" \"\/jboss\" \"\/app\/logs\")\n\nfor mountpoint in \"${MOUNTPOINTS[@]}\"; do\n    echo \"Checking directory permission for $mountpoint\"\n    \n    if [ ! -d \"$mountpoint\" ]; then\n        echo \"  ERROR: Directory $mountpoint does not exist\"\n        exit 1\n    fi\n    \n    if ! mountpoint -q \"$mountpoint\"; then\n        echo \"  WARNING: $mountpoint is not mounted\"\n    fi\n    \n    # Check and set permissions (matches Ansible: Check Directory Permission)\n    # Ansible ensures mode: 0755, owner: jboss, group: jbadmin\n    sudo chown jboss:jbadmin \"$mountpoint\"\n    sudo chmod 755 \"$mountpoint\"\n    \n    # Verify final permissions\n    FINAL_OWNER=$(stat -c '%U:%G' \"$mountpoint\" 2>\/dev\/null || echo \"N\/A\")\n    FINAL_PERMS=$(stat -c '%a' \"$mountpoint\" 2>\/dev\/null || echo \"N\/A\")\n    echo \"  \u2713 Verified: $mountpoint - $FINAL_OWNER ($FINAL_PERMS)\"\ndone\n\necho \"\"\necho \"=== Mount Point Permissions Check Complete ===\"\necho \"All mount points verified with correct permissions (jboss:jbadmin, 755)\"\n","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"configure_sysctl","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Configuring Kernel Parameters (sysctl) ===\"\n\n# Kernel parameters from defaults_main.yml\ndeclare -A SYSCTL_PARAMS=(\n    [\"net.core.wmem_default\"]=\"16777216\"\n    [\"net.core.wmem_max\"]=\"655360\"\n    [\"net.core.rmem_max\"]=\"26214400\"\n    [\"net.ipv4.tcp_wmem\"]=\"4096 16384 655360\"\n    [\"net.ipv4.tcp_rmem\"]=\"4096 87380 26214400\"\n)\n\n# Apply sysctl parameters\necho \"Applying kernel parameters...\"\nfor param in \"${!SYSCTL_PARAMS[@]}\"; do\n    value=\"${SYSCTL_PARAMS[$param]}\"\n    echo \"Setting $param = $value\"\n    \n    # Apply immediately\n    sudo sysctl -w \"$param=$value\" || {\n        echo \"Warning: Failed to set $param\"\n    }\n    \n    # Add to \/etc\/sysctl.conf if not present\n    if ! grep -q \"^$param\" \/etc\/sysctl.conf 2>\/dev\/null; then\n        echo \"$param = $value\" | sudo tee -a \/etc\/sysctl.conf\n    else\n        # Update existing value\n        sudo sed -i \"s|^$param.*|$param = $value|\" \/etc\/sysctl.conf\n    fi\ndone\n\n# Reload sysctl\nsudo sysctl -p \/etc\/sysctl.conf || true\n\necho \"=== Kernel Parameters Configuration Complete ===\"\necho \"Current values:\"\nfor param in \"${!SYSCTL_PARAMS[@]}\"; do\n    echo \"  $param = $(sysctl -n \"$param\" 2>\/dev\/null || echo 'N\/A')\"\ndone","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"configure_ulimit","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Configuring Ulimit Parameters ===\"\n\n# Ulimit configuration file\nULIMIT_FILE=\"\/etc\/security\/limits.d\/00-jboss.conf\"\n\n# Ulimit parameters from defaults_main.yml\ncat <<EOF | sudo tee \"$ULIMIT_FILE\" > \/dev\/null\n# JBoss ulimit configuration\n# Based on Ansible role: ansible-role-ulimit\n\n# nofile (file descriptors)\n* soft nofile 65536\n* hard nofile 65536\n\n# nproc (processes)\n* soft nproc 16384\n* hard nproc 16384\n\n# stack (stack size)\n* soft stack 3276\n* hard stack 3276\nEOF\n\necho \"Ulimit configuration written to $ULIMIT_FILE\"\necho \"Configuration:\"\ncat \"$ULIMIT_FILE\"\n\n# Note: ulimit changes take effect on next login\necho \"Note: Ulimit changes will take effect on next user login\"\necho \"Current ulimit values for current session:\"\nulimit -a || true\n\necho \"=== Ulimit Configuration Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"configure_jboss_umask","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Configuring Umask for JBoss User ===\"\n\nJBOSS_USER=\"jboss\"\nUMASK_VALUE=\"0022\"\nBASH_PROFILE=\"\/home\/$JBOSS_USER\/.bash_profile\"\n\n# Ensure jboss user exists\nif ! id \"$JBOSS_USER\" &>\/dev\/null; then\n    echo \"ERROR: User $JBOSS_USER does not exist\"\n    exit 1\nfi\n\n# Ensure bash_profile exists\nif [ ! -f \"$BASH_PROFILE\" ]; then\n    echo \"Creating $BASH_PROFILE\"\n    sudo -u \"$JBOSS_USER\" touch \"$BASH_PROFILE\"\n    sudo chown \"$JBOSS_USER:jbadmin\" \"$BASH_PROFILE\"\nfi\n\n# Add or update umask in bash_profile\nif grep -q \"^umask\" \"$BASH_PROFILE\" 2>\/dev\/null; then\n    echo \"Updating umask in $BASH_PROFILE\"\n    sudo sed -i \"s\/^umask.*\/umask $UMASK_VALUE\/\" \"$BASH_PROFILE\"\nelse\n    echo \"Adding umask to $BASH_PROFILE\"\n    echo \"umask $UMASK_VALUE\" | sudo tee -a \"$BASH_PROFILE\" > \/dev\/null\nfi\n\n# Set correct ownership\nsudo chown \"$JBOSS_USER:jbadmin\" \"$BASH_PROFILE\"\n\necho \"Umask configuration:\"\ngrep \"^umask\" \"$BASH_PROFILE\" || echo \"umask $UMASK_VALUE\"\n\necho \"=== Umask Configuration Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"configure_jboss_sudoers","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Configuring Sudoers for JBoss ===\"\n\nSUDOERS_FILE=\"\/etc\/sudoers.d\/jboss\"\n\n# Sudoers content from Ansible task\ncat <<EOF | sudo tee \"$SUDOERS_FILE\" > \/dev\/null\n#%itnocteam ALL=(jboss) NOPASSWD: \/softwares\/jboss\/*\/httpd\/*\/sbin\/*\n#%itnocteam ALL=(jboss) NOPASSWD: \/jboss\/nodes\/*\/*\/bin\/*\nDefaults! \/softwares\/jboss\/*\/httpd\/*\/sbin\/* !requiretty\nEOF\n\n# Set correct permissions (u-wx,g-wx,o-rwx = 0000, but readable by root)\nsudo chmod 0440 \"$SUDOERS_FILE\"\nsudo chown root:root \"$SUDOERS_FILE\"\n\n# Validate sudoers file\nif sudo visudo -cf \"$SUDOERS_FILE\"; then\n    echo \"Sudoers file validated successfully\"\n    echo \"Sudoers configuration:\"\n    sudo cat \"$SUDOERS_FILE\"\nelse\n    echo \"ERROR: Sudoers file validation failed\"\n    exit 1\nfi\n\necho \"=== Sudoers Configuration Complete ===\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"start_service","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Starting JBoss Service ===\"\n\nSERVICE_NAME=\"jboss\"\n\n# Verify service file exists\nif [ ! -f \"\/etc\/systemd\/system\/${SERVICE_NAME}.service\" ]; then\n    echo \"ERROR: Service file not found: \/etc\/systemd\/system\/${SERVICE_NAME}.service\"\n    echo \"Please ensure configure_systemd.sh has completed successfully\"\n    exit 1\nfi\n\n# Reload systemd to ensure service is recognized\nsudo systemctl daemon-reload\n\n# Enable service to start on boot\necho \"Enabling JBoss service...\"\nsudo systemctl enable \"$SERVICE_NAME\" || {\n    echo \"WARNING: Failed to enable service\"\n}\n\n# Check if service is already running\nif systemctl is-active --quiet \"$SERVICE_NAME\"; then\n    echo \"JBoss service is already running\"\nelse\n    echo \"Starting JBoss service...\"\n    sudo systemctl start \"$SERVICE_NAME\" || {\n        echo \"ERROR: Failed to start JBoss service\"\n        echo \"Checking service status...\"\n        sudo systemctl status \"$SERVICE_NAME\" || true\n        echo \"\"\n        echo \"Checking logs...\"\n        sudo journalctl -u \"$SERVICE_NAME\" -n 50 --no-pager || true\n        exit 1\n    fi\nfi\n\n# Wait a moment for service to initialize\nsleep 5\n\n# Verify service is running\nif systemctl is-active --quiet \"$SERVICE_NAME\"; then\n    echo \"\u2713 JBoss service is running\"\n    \n    # Show service status\n    echo \"\"\n    echo \"=== Service Status ===\"\n    sudo systemctl status \"$SERVICE_NAME\" --no-pager -l || true\n    \n    # Show recent logs\n    echo \"\"\n    echo \"=== Recent Logs ===\"\n    sudo journalctl -u \"$SERVICE_NAME\" -n 20 --no-pager || true\n    \n    # Check if JBoss is listening on ports\n    echo \"\"\n    echo \"=== Port Status ===\"\n    if command -v ss &>\/dev\/null; then\n        sudo ss -tlnp | grep -E \"(8080|8443|9990|9993)\" || echo \"Ports not yet listening (may still be starting)\"\n    elif command -v netstat &>\/dev\/null; then\n        sudo netstat -tlnp | grep -E \"(8080|8443|9990|9993)\" || echo \"Ports not yet listening (may still be starting)\"\n    fi\n    \n    echo \"\"\n    echo \"=== JBoss Service Started Successfully ===\"\n    echo \"Management Console: http:\/\/<server-ip>:9990\"\n    echo \"Application: http:\/\/<server-ip>:8080\"\nelse\n    echo \"ERROR: JBoss service failed to start\"\n    echo \"Service status:\"\n    sudo systemctl status \"$SERVICE_NAME\" --no-pager -l || true\n    echo \"\"\n    echo \"Recent logs:\"\n    sudo journalctl -u \"$SERVICE_NAME\" -n 50 --no-pager || true\n    exit 1\nfi","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"configure_systemd","description":"","attrs":{"type":"","script":"set -e\n\necho \"=== Configuring JBoss Systemd Service ===\"\n\n# JBoss paths\nJBOSS_HOME=\"\/softwares\/jboss\"\nJBOSS_USER=\"jboss\"\nJBOSS_GROUP=\"jbadmin\"\nJBOSS_LOG_DIR=\"\/app\/logs\/jboss\"\n\n# Verify JBoss installation\nif [ ! -f \"$JBOSS_HOME\/bin\/standalone.sh\" ]; then\n    echo \"ERROR: JBoss EAP not found at $JBOSS_HOME\"\n    echo \"Please ensure deploy_binaries.sh has completed successfully\"\n    exit 1\nfi\n\n# Verify jboss user exists\nif ! id \"$JBOSS_USER\" &>\/dev\/null; then\n    echo \"ERROR: $JBOSS_USER user does not exist\"\n    exit 1\nfi\n\n# Create log directory\nsudo mkdir -p \"$JBOSS_LOG_DIR\"\nsudo chown \"$JBOSS_USER:$JBOSS_GROUP\" \"$JBOSS_LOG_DIR\"\nsudo chmod 755 \"$JBOSS_LOG_DIR\"\n\n# Create systemd service file\nSERVICE_FILE=\"\/etc\/systemd\/system\/jboss.service\"\n\necho \"Creating systemd service file: $SERVICE_FILE\"\n\nsudo tee \"$SERVICE_FILE\" > \/dev\/null <<EOF\n[Unit]\nDescription=JBoss EAP Application Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=$JBOSS_USER\nGroup=$JBOSS_GROUP\n\n# Environment\nEnvironment=\"JAVA_HOME=\/usr\/lib\/jvm\/java-11-openjdk\"\nEnvironment=\"JBOSS_HOME=$JBOSS_HOME\"\nEnvironment=\"JBOSS_LOG_DIR=$JBOSS_LOG_DIR\"\n\n# Working directory\nWorkingDirectory=$JBOSS_HOME\n\n# ExecStart\nExecStart=$JBOSS_HOME\/bin\/standalone.sh -b 0.0.0.0 -bmanagement 0.0.0.0\n\n# StandardOutput and StandardError\nStandardOutput=journal\nStandardError=journal\nSyslogIdentifier=jboss\n\n# Restart policy\nRestart=on-failure\nRestartSec=10\n\n# Security\nNoNewPrivileges=true\nPrivateTmp=true\n\n# Resource limits\nLimitNOFILE=65536\nLimitNPROC=16384\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# Set correct permissions\nsudo chmod 644 \"$SERVICE_FILE\"\n\n# Reload systemd\nsudo systemctl daemon-reload\n\necho \"\u2713 Systemd service file created\"\necho \"Service file: $SERVICE_FILE\"\necho \"JBoss Home: $JBOSS_HOME\"\necho \"JBoss User: $JBOSS_USER\"\necho \"Log Directory: $JBOSS_LOG_DIR\"\necho \"\"\necho \"To start JBoss: sudo systemctl start jboss\"\necho \"To enable on boot: sudo systemctl enable jboss\"","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Service1","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"8309e720_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"65dd82a8_runbook","description":"","task_definition_list":[{"type":"DAG","name":"fe0acc64_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Package1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"fe0acc64_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}}],"app_profile_list":[{"name":"Profile 2","description":"","variable_list":[{"type":"LOCAL","name":"VM_NAME_INPUT","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":""}],"action_list":[],"deployment_create_list":[{"type":"GREENFIELD","name":"deployment_91903ea6","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"Package1","kind":"app_package"}],"substrate_local_reference":{"name":"VM1","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]}],"credential_definition_list":[{"type":"PASSWORD","name":"Login","description":"","username":"qnbuser","secret":{"attrs":{"secret_reference":{},"is_secret_modified":true},"value":"nC3u8MzrdAx1EAvWAWcfO7FI9rqox3mSgtKW8iM\/A9V4PuIrJYpqzQ==:utf-8"},"cred_class":"static"}],"default_credential_local_reference":{"name":"Login","kind":"app_credential"},"type":"USER","client_attrs":{"deployment_91903ea6":{"x":434,"y":107.5}},"global_variable_reference_list":[]}},"api_version":"3.0","product_version":"4.3.0","metadata":{"last_update_time":"1768399768697814","creation_time":"1768392004857206","spec_version":24,"name":"Jboss-Existing","kind":"blueprint"},"contains_secrets":true}