{"status":{},"spec":{"name":"EraPostgresProvision","description":"","resources":{"service_definition_list":[{"name":"Era","description":"","variable_list":[{"type":"LOCAL","name":"CLEANUP_OPERATION_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"CLUSTER_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"COMPUTE_PROF_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"CREATE_OPERATION_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DB_ENTITY_NAME","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DB_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DB_PARAM_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DB_SERVER_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DB_SERVER_IP","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"DEREGISTER_OPERATION_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"NETWORK_PROF_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"SLA_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"SOFTWARE_PROF_ID","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"SOFTWARE_PROF_VERSION_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"vm_name","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""}],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"975ed99a_runbook","description":"","task_definition_list":[{"type":"DAG","name":"0bfadcbf_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"0bfadcbf_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"cf884050_runbook","description":"","task_definition_list":[{"type":"DAG","name":"9ade3d68_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"9ade3d68_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"6bcf94d3_runbook","description":"","task_definition_list":[{"type":"DAG","name":"1124d60e_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"1124d60e_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"84c12573_runbook","description":"","task_definition_list":[{"type":"DAG","name":"0ae24e3c_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"0ae24e3c_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"6e2e5ff2_runbook","description":"","task_definition_list":[{"type":"DAG","name":"bf858e3b_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"bf858e3b_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""},{"name":"Postgres","description":"","variable_list":[],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"01945104_runbook","description":"","task_definition_list":[{"type":"DAG","name":"6fba9cbb_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Postgres","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"6fba9cbb_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"fe42eb38_runbook","description":"","task_definition_list":[{"type":"DAG","name":"8bee20f0_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Postgres","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"8bee20f0_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"ffd25064_runbook","description":"","task_definition_list":[{"type":"DAG","name":"04cc6e24_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Postgres","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"04cc6e24_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"ef6acd35_runbook","description":"","task_definition_list":[{"type":"DAG","name":"9d7e4dfb_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Postgres","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"9d7e4dfb_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"b81e8f8b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"897e9b24_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Postgres","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"897e9b24_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"EXISTING_VM","name":"EraServer","description":"","variable_list":[],"action_list":[],"create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"@@{era_ip}@@"},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"era_creds","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"60","retries":"5","address":"@@{ip_address}@@","disable_readiness_probe":true,"connection_protocol":""}},{"type":"EXISTING_VM","name":"Era_PostgreSQL_DB","description":"","variable_list":[],"action_list":[],"create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"@@{Era.DB_SERVER_IP}@@"},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"db_server_creds","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"60","retries":"5","address":"@@{ip_address}@@","disable_readiness_probe":false,"connection_protocol":""}}],"package_definition_list":[{"type":"DEB","name":"EraPackage","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"Era","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"a56589a3_runbook","description":"","task_definition_list":[{"type":"DAG","name":"7bd63f34_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"GetClusterID","kind":"app_task"},"to_task_reference":{"name":"GetProfileIDs","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"GetProfileIDs","kind":"app_task"},"to_task_reference":{"name":"GetSLAID","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"MonitorOperation","kind":"app_task"},"to_task_reference":{"name":"GetDatabaseInfo","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"ProvisionDB","kind":"app_task"},"to_task_reference":{"name":"MonitorOperation","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"GetSLAID","kind":"app_task"},"to_task_reference":{"name":"generate_vm_name","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"generate_vm_name","kind":"app_task"},"to_task_reference":{"name":"ProvisionDB","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"GetClusterID","kind":"app_task"},{"name":"GetProfileIDs","kind":"app_task"},{"name":"GetSLAID","kind":"app_task"},{"name":"generate_vm_name","kind":"app_task"},{"name":"ProvisionDB","kind":"app_task"},{"name":"MonitorOperation","kind":"app_task"},{"name":"GetDatabaseInfo","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"EraPackage","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"GetClusterID","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\n\n# Construct API Headers\nget_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Get Cluster ID\napi_url = \"https:\/\/{}\/era\/v0.9\/clusters\".format(era_ip)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    cluster_id = resp[0]['id']\n    print(\"CLUSTER_ID={0}\".format(cluster_id))\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["CLUSTER_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"GetProfileIDs","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\nsoftware_profile = \"@@{software_profile}@@\"\ncompute_profile = \"@@{compute_profile}@@\"\nnetwork_profile = \"@@{network_profile}@@\"\ndatabase_parameter = \"@@{database_parameter}@@\"\n\n# Construct API Headers\nget_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Get Software Profile ID\napi_url = \"https:\/\/{}\/era\/v0.9\/profiles?type=Software&name={}\".format(era_ip, software_profile)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    software_prof_id = resp['id']\n    print(\"SOFTWARE_PROF_ID={0}\".format(software_prof_id))\n    \n    # Get Software Profile Version ID\n    api_url_version = \"https:\/\/{}\/era\/v0.9\/profiles\/{}\/versions\/latest\".format(era_ip, software_prof_id)\n    r_version = urlreq(api_url_version, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n    \n    if r_version.ok:\n        resp_version = json.loads(r_version.content.decode(\"utf-8\"))\n        if 'id' in resp_version:\n            software_prof_version_id = resp_version['id']\n            print(\"SOFTWARE_PROF_VERSION_ID={0}\".format(software_prof_version_id))\n        else:\n            print(\"GET request failed: No 'id' field found in version response\", r_version.content)\n            exit(1)\n    else:\n        print(\"GET request failed for software profile version\", r_version.content)\n        exit(1)\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)\n\n# Get Compute Profile ID\napi_url = \"https:\/\/{}\/era\/v0.9\/profiles?type=Compute&name={}\".format(era_ip, compute_profile)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    compute_prof_id = resp['id']\n    print(\"COMPUTE_PROF_ID={0}\".format(compute_prof_id))\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)\n\n# Get Network Profile ID\napi_url = \"https:\/\/{}\/era\/v0.9\/profiles?type=Network&name={}\".format(era_ip, network_profile)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    network_prof_id = resp['id']\n    print(\"NETWORK_PROF_ID={0}\".format(network_prof_id))\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)\n\n# Get DB Parameter ID\napi_url = \"https:\/\/{}\/era\/v0.9\/profiles?type=Database_Parameter&name={}\".format(era_ip, database_parameter)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    db_param_id = resp['id']\n    print(\"DB_PARAM_ID={0}\".format(db_param_id))\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["COMPUTE_PROF_ID","DB_PARAM_ID","NETWORK_PROF_ID","SOFTWARE_PROF_ID","SOFTWARE_PROF_VERSION_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"GetSLAID","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\nsla_name = \"@@{sla_name}@@\"\n\n# Construct API Headers\nget_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Get the list of SLAs\napi_url = \"https:\/\/{}\/era\/v0.9\/slas\".format(era_ip)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\n# Find the desired SLA, and set the corresponding ID to the variable\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    for sla in resp:\n        if sla['name'] == sla_name:\n            print(\"SLA_ID={0}\".format(sla['id']))\n            break\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["SLA_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"generate_vm_name","description":"","attrs":{"type":"","script":"#script\n\n# Append static 's' which stands for server at the beginning to the VM\nvm_name = \"db\"\n# Append static 'pc' which stands for Private Cloud to the VM\nvm_name += \"pg\"\n\n# Append static 'qnb' identifier\nvm_name += \"qnb\"\n\n# Append static environment variable to the VM\nvar_environment = \"@@{var_environment}@@\"\nvm_name += var_environment\n\n# Determine VM index based on array index for counter logic\nvar_array_index = @@{calm_array_index}@@\nif var_array_index%2 == 0:\n    vm_index = \"1\"\nelse:\n    vm_index = \"2\"\n\n# Fetch existing VMs based on suffix\npc_ip = \"@@{pc_ip}@@\"\npc_user = \"@@{pc_username}@@\"\npc_pass = \"@@{pc_password}@@\"\n\n# Construct API URL and Headers\napi_url = \"https:\/\/{}:9440\/api\/vmm\/v4.0\/ahv\/config\/vms?$filter=startswith(name,'{}{}')&$select=name\".format(pc_ip,vm_name,vm_index)\nget_headers = {'Content-Type': 'application\/json',  'Accept':'application\/json'}\n\n# Fetch VM Data and ETag\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=pc_user, passwd=pc_pass)\nif r.ok:\n    resp = json.loads(r.content)\n    print(resp)\n    if resp['metadata']['totalAvailableResults'] == 0:\n      vm_suffix = 0\n    else:\n      list_of_vms = [item['name'] for item in resp['data']]\n      list_of_vms.sort()\n      vm_suffix = int(list_of_vms[-1][-2:])\n    vm_count = (int(vm_index) * 100) + int(vm_suffix) + (int(var_array_index)\/\/2+1)\nelse:\n    print(\"Get request failed\", r.content)\n    exit(1)\n\nprint(\"vm_name = \" + str(vm_name) + str(vm_count))\n","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["vm_name"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"ProvisionDB","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\n\n# Construct API Headers\npost_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Construct API URL\napi_url = \"https:\/\/{}\/era\/v0.9\/dbservers\/provision\".format(era_ip)\n\n# Payload for DB Server Provisioning\npayload = {\n  \"actionArguments\": [\n    {\n      \"name\": \"client_public_key\",\n      \"value\": \"@@{db_public_key}@@\"\n    },\n    {\n      \"name\": \"vm_name\",\n      \"value\": \"@@{vm_name}@@\"\n    }\n  ],\n  \"nxClusterId\": \"@@{CLUSTER_ID}@@\",\n  \"databaseType\": \"postgres_database\",\n  \"latestSnapshot\": True,\n  \"networkProfileId\": \"@@{NETWORK_PROF_ID}@@\",\n  \"computeProfileId\": \"@@{COMPUTE_PROF_ID}@@\",\n  \"vmPassword\": None,\n  \"softwareProfileVersionId\": \"@@{SOFTWARE_PROF_VERSION_ID}@@\",\n  \"softwareProfileId\": \"@@{SOFTWARE_PROF_ID}@@\"\n}\n\n# Print payload JSON for debugging\npayload_json = json.dumps(payload, indent=2)\nprint(\"=\" * 80)\nprint(\"PAYLOAD JSON:\")\nprint(\"=\" * 80)\nprint(payload_json)\nprint(\"=\" * 80)\nprint()\n\n# Make the call and set the response operation ID to the variable\nr = urlreq(api_url, verb='POST', headers=post_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass, params=json.dumps(payload))\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    print(\"CREATE_OPERATION_ID={0}\".format(resp['operationId']))\nelse:\n    print(\"POST request failed\", r.content)\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["CREATE_OPERATION_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"MonitorOperation","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\ncreate_operation_id = \"@@{CREATE_OPERATION_ID}@@\"\n\n# Construct API Headers\nget_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Monitor the operation\nfor x in range(20):\n    print(\"Sleeping for 60 seconds.\")\n    sleep(60)\n    \n    # Construct API URL\n    api_url = \"https:\/\/{}\/era\/v0.9\/operations\/{}\".format(era_ip, create_operation_id)\n    r = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n    \n    if r.ok:\n        resp = json.loads(r.content.decode(\"utf-8\"))\n        percentage_complete = resp['percentageComplete']\n        print(\"Percentage Complete: {0}\".format(percentage_complete))\n        \n        # If complete, break out of loop\n        if percentage_complete == \"100\":\n            break\n    else:\n        print(\"GET request failed\", r.content)\n        exit(1)\n\n# Check final status\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    if resp['percentageComplete'] != \"100\":\n        print(\"Get Operation ID timed out\", json.dumps(resp, indent=4))\n        exit(1)\n    \n    # Get the newly provision DB Entity Name and set it to a variable\n    if 'entityName' in resp:\n        print(\"DB_ENTITY_NAME={0}\".format(resp['entityName']))\n    else:\n        print(\"Warning: entityName not found in response\")\nelse:\n    print(\"GET request failed\", r.content)\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["DB_ENTITY_NAME"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"GetDatabaseInfo","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\ndb_entity_name = \"@@{DB_ENTITY_NAME}@@\"\n\n# Construct API Headers\nget_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Get DB Server IP and ID\n# Since we provisioned a DB server VM, we use the dbservers endpoint\napi_url = \"https:\/\/{}\/era\/v0.9\/dbservers?name={}&detailed=true\".format(era_ip, db_entity_name)\nr = urlreq(api_url, verb='GET', headers=get_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp_list = json.loads(r.content.decode(\"utf-8\"))\n    \n    if isinstance(resp_list, list) and len(resp_list) > 0:\n        # Since we filtered by name, the target server is the first element\n        resp = resp_list[0]\n        \n        db_server_ip = resp.get('ipAddresses', [None])[0] or resp.get('ipAddress', 'N\/A')\n        print(\"DB_SERVER_IP={0}\".format(db_server_ip))\n        print(\"DB_SERVER_ID={0}\".format(resp['id']))\n    else:\n        print(\"No DB Server found with name: {}\".format(db_entity_name))\nelse:\n    print(\"GET request failed\", r.content)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["DB_ID","DB_SERVER_ID","DB_SERVER_IP"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"7bd63f34_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"a8f36ab1_runbook","description":"","task_definition_list":[{"type":"DAG","name":"99b487fd_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"1CleanupDB","kind":"app_task"},"to_task_reference":{"name":"2MonitorCleanupOp","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"3DeregisterDBServer","kind":"app_task"},"to_task_reference":{"name":"4MonitorDeregOp","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"2MonitorCleanupOp","kind":"app_task"},"to_task_reference":{"name":"3DeregisterDBServer","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"1CleanupDB","kind":"app_task"},{"name":"2MonitorCleanupOp","kind":"app_task"},{"name":"3DeregisterDBServer","kind":"app_task"},{"name":"4MonitorDeregOp","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"EraPackage","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"1CleanupDB","description":"","attrs":{"type":"","script":"era_ip = \"@@{era_ip}@@\"\nera_user = \"@@{era_creds.username}@@\"\nera_pass = \"@@{era_creds.secret}@@\"\ndb_server_id = \"@@{DB_SERVER_ID}@@\" # Ensure this is the DB Server UUID, not the DB UUID\n\n# Construct API Headers\ndelete_headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# VALID v0.9 API URL\n# delete_storage=true: Removes the VM and disks from the Nutanix Cluster\n# remove_from_ndb=true: Removes the registration entry from the NDB console\napi_url = \"https:\/\/{}\/era\/v0.9\/dbservers\/{}?delete_storage=true&remove_from_ndb=true\".format(era_ip, db_server_id)\n\nr = urlreq(api_url, verb='DELETE', headers=delete_headers, verify=False, auth=\"BASIC\", user=era_user, passwd=era_pass)\n\nif r.ok:\n    resp = json.loads(r.content.decode(\"utf-8\"))\n    # The response for a DELETE in v0.9 usually contains the operationId\n    print(\"CLEANUP_OPERATION_ID={0}\".format(resp.get('operationId', 'NO_OP_ID_RETURNED')))\nelse:\n    # If it fails, it's often because a Database is still attached to the server\n    print(\"DELETE request failed. Status: {0}, Content: {1}\".format(r.status_code, r.content))\n    exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["CLEANUP_OPERATION_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"2MonitorCleanupOp","description":"","attrs":{"type":"","script":"# Set creds, headers, and URL\nera_user = '@@{era_creds.username}@@'\nera_pass = '@@{era_creds.secret}@@'\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nurl     = \"https:\/\/@@{era_ip}@@:8443\/era\/v0.8\/operations\/@@{CLEANUP_OPERATION_ID}@@\"\n\n# Monitor the operation\nfor x in range(20):\n  \n  print \"Sleeping for 30 seconds.\"\n  sleep(30)\n  resp = urlreq(url, verb='GET', auth='BASIC', user=era_user, passwd=era_pass, headers=headers)\n  print \"Percentage Complete: {0}\".format(json.loads(resp.content)['percentageComplete'])\n  \n  # If complete, break out of loop\n  if json.loads(resp.content)['percentageComplete'] == \"100\":\n    break    \n\n# If the operation did not complete within 10 minutes, assume it's not successful and error out\nif json.loads(resp.content)['percentageComplete'] != \"100\":\n  print \"Cleanup Operation timed out\", json.dumps(json.loads(resp.content), indent=4)\n  exit(1)","script_type":"static_py3","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"SET_VARIABLE","name":"3DeregisterDBServer","description":"","attrs":{"type":"","script":"# Set creds and headers\nera_user = '@@{era_creds.username}@@'\nera_pass = '@@{era_creds.secret}@@'\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\n\n# Cleanup the DB and get Operation ID\nurl     = \"https:\/\/@@{era_ip}@@:8443\/era\/v0.8\/dbservers\/@@{DB_SERVER_ID}@@?remove=false&soft-remove=false&delete=true&delete-vm-snapshots=true&delete-vgs=true\"\nresp = urlreq(url, verb='DELETE', auth='BASIC', user=era_user, passwd=era_pass, headers=headers)\nif resp.ok:\n  print \"DEREGISTER_OPERATION_ID={0}\".format(json.loads(resp.content)['operationId'])\nelse:\n  print \"Deregister DB Server Operation failed\", json.dumps(json.loads(resp.content), indent=4)\n  exit(1)","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["DEREGISTER_OPERATION_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]},{"type":"EXEC","name":"4MonitorDeregOp","description":"","attrs":{"type":"","script":"# Set creds, headers, and URL\nera_user = '@@{era_creds.username}@@'\nera_pass = '@@{era_creds.secret}@@'\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nurl     = \"https:\/\/@@{era_ip}@@:8443\/era\/v0.8\/operations\/@@{DEREGISTER_OPERATION_ID}@@\"\n\n# Monitor the operation\nfor x in range(20):\n  \n  print \"Sleeping for 30 seconds.\"\n  sleep(30)\n  resp = urlreq(url, verb='GET', auth='BASIC', user=era_user, passwd=era_pass, headers=headers)\n  print \"Percentage Complete: {0}\".format(json.loads(resp.content)['percentageComplete'])\n  \n  # If complete, break out of loop\n  if json.loads(resp.content)['percentageComplete'] == \"100\":\n    break    \n\n# If the operation did not complete within 10 minutes, assume it's not successful and error out\nif json.loads(resp.content)['percentageComplete'] != \"100\":\n  print \"Deregistration Operation timed out\", json.dumps(json.loads(resp.content), indent=4)\n  exit(1)","script_type":"static_py3","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Era","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"99b487fd_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"DEB","name":"Package2","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"Postgres","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"8b1f1a7b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"58ca4a03_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Package2","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"58ca4a03_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"faacff5d_runbook","description":"","task_definition_list":[{"type":"DAG","name":"ee8bedbe_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Package2","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false,"status_map_list":[]}],"main_task_local_reference":{"name":"ee8bedbe_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}}],"app_profile_list":[{"name":"Default","description":"","variable_list":[{"type":"LOCAL","name":"compute_profile","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"PostgreSQL"},{"type":"LOCAL","name":"database_parameter","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"DEFAULT_POSTGRES_PARAMS"},{"type":"LOCAL","name":"db_name","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","editables":{"value":true},"value":"psql_@@{calm_time(\"%Y%m%d%H%M\")}@@"},{"type":"SECRET","name":"db_password","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"","is_secret_modified":false,"secret_reference":{}},"editables":{"value":true},"value":"qKJEZab2Zg+2VSejUJ9gJbBY0SPC9oQSL4B8dFgZ11X\/lvtUGrVQ71i4fQ==:utf-8"},{"type":"LOCAL","name":"db_public_key","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeTSmMNY9hiXa2xwY4Upxb2eMQSERVzI7Jc1pZJKSXpdJzf0UW+C5gMle6GXaLj7hWFeQKGgQlTjXDrKkwH2GA08mccu2f+0UkU8OO6dL9JTGQKJMsrury+7RWHex2xdZxqpJMcvhVslSZvRgsr9FWlfnnz55x2ssmU9Ynhu1ZIfaTvlI8gHQHiTeLvuzfnT8l2wNnNCx5IPbptowPeifwDpgwUoVx953dEjVdSmy8k+g7iTpUOqj49fDjyIfbUUJg25uDip04ifJ74KD8GRQc7k7qsAF7qxYyDjBbc7Mw+OrhHjVmVqTaFuRb9xy\/Xp4xppkOcCbnhlbL3aV0Na5z rsa-key-20260112"},{"type":"LOCAL","name":"era_ip","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"10.38.176.15"},{"type":"LOCAL","name":"network_profile","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"DEFAULT_OOB_POSTGRESQL_NETWORK"},{"type":"LOCAL","name":"sla_name","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"DEFAULT_OOB_BRONZE_SLA"},{"type":"LOCAL","name":"software_profile","description":"","is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","editables":{"value":true},"value":"POSTGRES_15.6_ROCKY_LINUX_8_OOB"},{"type":"LOCAL","name":"pc_username","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"admin"},{"type":"SECRET","name":"pc_password","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"SECRET","is_secret_modified":false,"secret_reference":{}},"editables":{"value":false},"value":"cyXJrgw6OotKhS\/wFBRE0ekvjEVbHhEl0NZQnKwJ0hyaK8cvCep96RiMhQ==:utf-8"},{"type":"LOCAL","name":"pc_ip","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"10.38.176.7"},{"type":"LOCAL","name":"var_environment","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"np"}],"action_list":[],"deployment_create_list":[{"type":"GREENFIELD","name":"f6be2786_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"Package2","kind":"app_package"}],"substrate_local_reference":{"name":"Era_PostgreSQL_DB","kind":"app_substrate"},"published_service_local_reference_list":[]},{"type":"GREENFIELD","name":"f9a4c530_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"EraPackage","kind":"app_package"}],"substrate_local_reference":{"name":"EraServer","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]}],"credential_definition_list":[{"type":"KEY","name":"db_server_creds","description":"","username":"era","secret":{"attrs":{"secret_reference":{},"is_secret_modified":true},"value":"u6m4CA2GfCOc84CBWKnv9a89YCSnD4qcF+3NFA49kcV0wBZjhUlEVk4tXXjR81I0B4LgUbMdvRLcCUXks4J\/VnTMT6eQUfmOHu1WlxbIYWHJjQfcIrsWnwzvILT\/LLhkgaAKWcGhCC0wemKa+U7L6iLm8Ns1hd0FuUupv+ugjQfSBKWjKrG9GMH+Hy+qkeuAlOUkE2SrGkDl6pIHkQ\/WAexJBH4SIjjAoD0dwPLZOr9YVb+ZSNqPdSdBGRs5q1elYu+XEpBnOjyR2YtuBM9aQJWgGEZUPz1A\/ptfdV0F7E73LEPauX5L+XY4M0jdVGQXGfEszn\/LSQVgC2VwaKH\/xbdubZ8GMv8jT5J7T9OPyZ9N4O6kKwffHgvmtjzO\/DUrdxln1ETXScdDN+GnLwR0zm\/DimnpmZ9oo+rYbNgsZEw+dlgJQRZuzRWiR1DQ3qZqxVG\/7Nh0RwL8+sTLj2CNlveVHMwm+2nhiNEBFkTi57VLv32VX8RibENrSwlIo440ZcvD\/RavQasomR9ct+6Nfs\/ZCG72XndACQa9DCXhgdkAoxENiXhOiZG5OUmzTu55IEU6xOPyKh1w+pLLxSLrdvRmFm5DlaawGC5e\/gmGFZ0Itnlr1s0hB2kqG+ekj+851jlncnpRUIuD08nYd8TeW05Ce3wJNp9TOAOtKguTPv2IP+oxUdQ3TB71lXdGtTlPmlI23hTyaRDiujdThHjKo4Om2nFSymbi45TV5tRSblooVWkw8BcqiiduYOgUBopM1386WuB3PqM8UZKY20LZ6UGWYjioRHV2KJC+6CwEJQmVy3AEkeCIZOZ6rmao3wPDYqxezV4EoSQTpo3CmtHLQ90\/XyjMUW7rCzpdF6N8Rb+yzYhBKa8v\/f7J22PkglYGif8ePpJqITyDjvXNQXBJ9IicoC1f8owiRwmB7q3sS5QE0KqBXb6J1KM7pgG\/6pnkQdaNFcFLvCTm06w9L8nXAeMUuKtBSGNuELIcCcIqYks5BWGyXT6KBDZCcDYEdFZHNipA9GeihXiOowrAvpm5EOW2rgzKyXTgfin\/mWpRmp5D6qiQgT5Si32nKaz+h3KF6bYan7vAenACLCNCY8EQynTN9EAFeH2BS\/AOXMy8KZArydtRZhqlXK1hO\/3KGYH+TlQvi6WakuJgIFdjogf+aNCNHY+tY2VQyUJddBb0Lg\/V3ByTfhlqf8P0zWJTWShkUjyJHqtwa2n66hGUSDGvGL+F72k3ZLFHbQGPE4RVtZCNbJo21Ejegb9+5NHvlfcrW4GVjuzoR3lvwktYudvB5gJnk+GTo0LngJsvy7je0kulEFVpWbSKE4C4yJz+adpJadGjXjLqEWbLrmU9BvvRnRxV+hCbKrGnA23IRH8v28+IPVJjvOngr3ohcyyv0SJrNz2jaf6t8u25wJc40ulv6NQ6DLlSH3AVOjLS3a5bKME1VVipjtMaRQqIQ2ngTwRllEnbLDalaVTLnGK6MsVuRgFem8w3iwknmX0Rpn7llxNxXBELXCaH6xq4NUvkL\/C\/iQHrIaFXWmKKxIihcvqrsKCJ\/\/O2o1iY60vkrfDmOhQYquAAZagH+r3mUKSAhc8\/dt15ZxTFljk8QDIlQrE7OMbv6KxnF1eaQBabHl0vemYjnHJEMj\/0U5NJywMLebghrWgfM0LefvAn3aRDXqaKJqEW3J2p5bkRVy90g2Q3BVXmA23TfjV7gf5ZI4m64FG5R+mr7\/GJ2wZrUjJuO6w7o1jdQtKuvoD3R+mhzK1h57OL6+AUBFhuHgZHgsZOUA3o6iYymYVtC3HPL0MqVvgSD18RARvVW+CsKtqnSuvUI3TeMbCKtjRfAO0rlo7r+8R8VJjt2hKmJy9vIR\/cPVCcQTKBM0FfGcjnd269OppUfbUKCTv\/2hRP\/h754YG66gSYjHg5bO62ZIqDhgGd2FlMC1kpNx6nH9UEwG0=:utf-8"},"cred_class":"static"},{"type":"PASSWORD","name":"era_creds","description":"","username":"admin","secret":{"attrs":{"secret_reference":{},"is_secret_modified":true},"value":"9VX39COpTt9aSwmd1vp0Ft8osnqWeAaof3c8q7UB5WGU\/DUVVpy2RlfWPA==:utf-8"},"cred_class":"static"}],"default_credential_local_reference":{"name":"era_creds","kind":"app_credential"},"type":"USER","client_attrs":{"null":{"y":443,"x":658.75},"f6be2786_deployment":{"y":331,"x":827.75},"f9a4c530_deployment":{"y":304,"x":511}},"global_variable_reference_list":[]}},"api_version":"3.0","product_version":"4.3.0","metadata":{"last_update_time":"1768343700203188","creation_time":"1768236055365706","spec_version":18,"name":"EraPostgresProvision","kind":"blueprint"},"contains_secrets":true}